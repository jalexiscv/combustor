<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class {{ (table | plural | underscore) | capitalize }} extends CI_Controller {

	public function __construct()
	{
		parent::__construct();

		$this->load->model('{{ table | singular }}', '', TRUE);
{% for column in foreign_keys %}
		$this->load->model('{{ column | underscore | replace({ '_id': '' }) }}', '', TRUE);
{% endfor %}
	}

	/**
	 * Shows the form for creating a new item.
	 *
	 * @return view
	 */
	public function create()
	{
		$data = array();
{% for column in foreign_keys %}
		$data['{{ column | plural | underscore | replace({ '_id': '' }) }}'] = $this->{{ column | underscore | replace({ '_id': '' }) }}->get()->as_dropdown();
{% endfor %}

		$this->load->view('{{ table | plural }}/create', $data);
	}

	/**
	 * Deletes the specified item from storage.
	 *
	 * @param  integer $id
	 * @return redirect
	 */
	public function delete($id)
	{
		if (empty($id))
		{
			show_404();
		}

		if ($this->{{ table | singular }}->delete($id))
		{
			$this->session->set_flashdata('notification', 'The {{ table | singular | replace({ '_': ' ' }) }} has been deleted successfully!');
			$this->session->set_flashdata('alert', 'success');
		}
		else
		{
			$this->session->set_flashdata('notification', 'Oops! An unexpected error occured.');
			$this->session->set_flashdata('alert', 'error');
		}

		redirect('{{ table | plural }}');
	}

	/**
	 * Shows the form for editing the specified item.
	 *
	 * @param  integer $id
	 * @return view
	 */
	public function edit($id)
	{
		if (empty($id))
		{
			show_404();
		}

		$data = array();
		$data['item'] = $this->{{ table | singular }}->find($id);
{% for column in foreign_keys %}
		$data['{{ column | plural | underscore | replace({ '_id': '' }) }}'] = $this->{{ column | underscore | replace({ '_id': '' }) }}->get()->as_dropdown();
{% endfor %}

		$this->load->view('{{ table | plural }}/edit', $data);
	}

	/**
	 * Returns a listing of items.
	 *
	 * @return view
	 */
	public function index()
	{
		list($items, $links) = $this->{{ table | singular }}->paginate(10);

		$this->load->view('{{ table | plural }}/index', compact('items', 'links'));
	}

	/**
	 * Shows the specified item.
	 *
	 * @return view
	 */
	public function show($id)
	{
		if (empty($id))
		{
			show_404();
		}

		$data = array('item' => $this->{{ table | singular }}->find($id));

		$this->load->view('{{ table | plural }}/show', $data);
	}

	/**
	 * Stores the specified item to storage.
	 *
	 * @return redirect
	 */
	public function store()
	{
		if ($this->{{ table | singular }}->validate($this->input->post()))
		{
			$this->{{ table | singular }}->insert($this->input->post());

			$this->session->set_flashdata('notification', 'The {{ table | singular | replace({ '_': ' ' }) }} has been created successfully!');
			$this->session->set_flashdata('alert', 'success');

			redirect('{{ table | plural }}');
		}

		redirect('{{ table | plural }}/create');
	}

	/**
	 * Updates the specified item from storage.
	 *
	 * @param  integer $id
	 * @return redirect
	 */
	public function update($id)
	{
		if (empty($id))
		{
			show_404();
		}

		if ($this->{{ table | singular }}->validate($this->input->input_stream()))
		{
			$this->{{ table | singular }}->update($id, $this->input->input_stream());

			$this->session->set_flashdata('notification', 'The {{ table | singular | replace({ '_': ' ' }) }} has been updated successfully!');
			$this->session->set_flashdata('alert', 'success');

			redirect('{{ table | plural }}');
		}

		redirect('{{ table | plural }}/' . $id);
	}

}